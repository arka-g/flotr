
<script>
  // This is called with the results from from FB.getLoginStatus().
  function statusChangeCallback(response) {
    console.log('statusChangeCallback');
    console.log(response);
    // The response object is returned with a status field that lets the
    // app know the current login status of the person.
    // Full docs on the response object can be found in the documentation
    // for FB.getLoginStatus().
    if (response.status === 'connected') {
      // Logged into your app and Facebook.
      testAPI();
    } else if (response.status === 'not_authorized') {
      // The person is logged into Facebook, but not your app.
    } else {
      // The person is not logged into Facebook, so we're not sure if
      // they are logged into this app or not.
    }
  }

  // This function is called when someone finishes with the Login
  // Button.  See the onlogin handler attached to it in the sample
  // code below.
  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
  }

  window.fbAsyncInit = function() {
  FB.init({
    appId      : '635939879882595',
    cookie     : true,  // enable cookies to allow the server to access
                        // the session
    xfbml      : true,  // parse social plugins on this page
    version    : 'v2.5' // use version 2.2
  });

  // Now that we've initialized the JavaScript SDK, we call
  // FB.getLoginStatus().  This function gets the state of the
  // person visiting this page and can return one of three states to
  // the callback you provide.  They can be:
  //
  // 1. Logged into your app ('connected')
  // 2. Logged into Facebook, but not your app ('not_authorized')
  // 3. Not logged into Facebook and can't tell if they are logged into
  //    your app or not.
  //
  // These three cases are handled in the callback function.

  FB.getLoginStatus(function(response) {
    statusChangeCallback(response);
  });

  };

  // Load the SDK asynchronously
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));

  // Here we run a very simple test of the Graph API after login is
  // successful.  See statusChangeCallback() for when this call is made.
  function testAPI() {
    console.log('Welcome!  Fetching your information.... ');
    FB.api('/me', function(response) {
      console.log('Successful login for: ' + response.name);
    });
  }
</script>



<div id="menu"> <!--  Main menu, slides out from left-->
  <span id="menu-close-btn" onclick="toggleMenu()">X</span>
  <h1><a href="/">Flotr</a></h1>
  <% if user_signed_in? %>
    <h2><%= link_to 'Profile', profile_path %></h2>
    <h2><%= link_to 'Settings', edit_user_registration_path %></h2>
    <h2><%= link_to 'Browse Tags', browse_path %></h2>
    <h2><%= link_to 'Sign out', destroy_user_session_path, :method => :delete %></h2>
  <% else %>
    <h2><%= link_to 'Log in', new_user_session_path %></h2>
    <h2><%= link_to 'Sign up', new_user_registration_path %></h2>
    <h2><%= link_to 'Browse Tags', browse_path %></h2>
    <fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
    </fb:login-button>
  <% end %>
</div>

<div id="controls"> <!-- Buttons/controls... the circular icons on the main page -->
  <div class="invisible">
    <%= will_paginate @tags %>
  </div>
  <div id="controls-tl"> <!-- top-left -->
    <div>
      <span class="flotr-bars circle-icon" onclick="toggleMenu()"></span>
      <span class="tooltip" id="tooltip-menu">MENU</span>
    </div>
    <div id="pic-info">
      <h3 id="info-title"></h3>
      <p id="info-tag"></p>
    </div>
  </div>

  <!-- <span id="up-btn" class="flotr-chevron-up circle-icon chev-up"></span> -->

  <div id="controls-tr"> <!-- top-right -->
    <div>
      <a href="<%=  new_image_path %>">
        <span class="flotr-cloud-upload circle-icon"></span>
        <span class="tooltip" id="tooltip-upload">UPLOAD</span>
      </a>
    </div>
<!--     <span class="flotr-bell-o circle-icon">
      <span class="tooltip" id="tooltip-alerts">ALERTS</span>
    </span> -->
    <div>
      <span class="flotr-info circle-icon" onclick="info()"></span>
      <span class="tooltip" id="tooltip-info">INFO</span>
    </div>
  </div>

  <span id="right-btn" class="flotr-chevron-right circle-icon chev-right" onclick="nextPage()"></span>

  <div id="controls-br"> <!-- bottom-right -->
    <div class="bottom-button">
      <span class="tooltip" id="tooltip-like">LIKE</span>
      <span id="like-btn" class="flotr-heart-o circle-icon" onclick="toggleLike()"></span>
    </div>
    <div class="bottom-button">
      <span class="tooltip" id="tooltip-comment">COMMENT</span>
      <span class="flotr-comment-o circle-icon" onclick="goToComments()"></span>
    </div>
  </div>

  <div id="more" class="bottom-button">
    <!-- <a href="" id="more-btn"> -->
      <span class="tooltip" id="tooltip-more">MORE<br>OF THE<br>SAME</span>
      <span id="down-btn" class="flotr-chevron-down circle-icon chev-down" onclick="seeMore()"></span>
    <!-- </a> -->
  </div>

  <div id="controls-bl" class="bottom-button"> <!-- bottom-left -->
    <a href="<%= search_path %>" id="search-btn"><span class="tooltip" id="tooltip-search">SEARCH</span>
    <span class="flotr-search circle-icon"></span></a>
  </div>

  <span id="left-btn" class="flotr-chevron-left circle-icon chev-left" onclick="prevPage()"></span>
</div>

<div id="welcome" class="invisible"> <!-- Welcome/Info screen, set to "invisible" by default -->
  <h1 class="main-title">Welcome to Flotr!</h1>
  <h2 class="main-subtitle">Your ultimate source of inspiration.</h2>
  <h3 class="main-text">Navigate with your keyboard:</h3>
  <%=image_tag("keyboard.png", id: "keyboard")%>
  <div id="welcome-info">
    <h3 class="main-text group">Click anywhere to close this.</h3>
    <h3 class="main-text group">Click  <span class="flotr-info welcome-i"></span>  to see this again.</h3>
  </div>
</div>

<div id="bg"> <!-- background/big picture -->
  <!--  link_to tag.images.first do  -->
  <% @tags.each do |tag| %>
    <%= image_tag( tag.images.first.image.url, :class => "bg-img" ) %>
    <%= link_to 'More like this', tag_path(tag: tag.name, page: 1), :class => "invisible", :id => "more-rb" %>
    <%= link_to 'Direct link', tag.images.first, :class => "invisible", :id => "link-rb" %>
    <%= content_tag("p", tag.name, :class => "invisible", :id => "tag-rb") %>
    <%= content_tag("p", tag.images.first.title, :class => "invisible", :id => "title-rb") %>
  <% end %>
</div>

<%= javascript_include_tag "flotr_nav" %>
<%= javascript_tag do %>
  setPageLimit(<%= @tags.total_pages %>, "<%= request.path %>");
<% end %>
